# Cheryl's Puzzle Experiment Interface

The code was written in Python 3.10.0 and R 4.2.2. 
The Python package versions are stored in ``requirements.txt``. 

The code for the analysis and modeling was inspired by the work of Top et al, 2023, which can be found at https://github.com/jdtoprug/EpistemicToMProject.

## The interface

The code for the interface can be found in the ``interface`` folder.
The interface can be run by calling ``quickstart.py``. 

* ``img`` - folder containing all images used in the interfaces and their respective sources
* ``text`` - folder containing parts of the text shown in the interface

* ``Participant puzzles.csv`` - the file containing the puzzle order as shown to each participant by ID
* ``background_form.py`` - main logic for the background form to be shown at the end of the experiment
* ``practice_trials.py`` - main logic for practice trials and detailed puzzle instructions to be shown at the start of the experiment
* ``puzzle.py`` - main logic for the puzzle: display, formatting, time-keeping, storing participants actions
* ``question_bank.csv`` - all 64 puzzles generated for the experiment
* ``question_bank.txt`` - all 16 birthday puzzles in text format (as shown to the participants)
* ``quickstart.py`` - file to run
* ``utilities.py`` - contains useful functions, not necessarily part of the basic work flow
* ``window.py`` - general specifications for window formatting (size, color etc)

## The analysis

The code for the statistical analysis can be found in the ``analysis`` folder.

* ``plots`` - folder containing all plots generated by running the code in ``analysis.py``
* ``all_results`` - folder containing the results of the experiment divided by the date the experiment took place.

* ``All answers_all.csv`` - the aggregated participant answers from ``all_results``
* ``All answers_puzzles.csv`` - same as ``All answers_all.csv`` but with the p-beauty answers removed and additional
helpful variables added (see ``analysis_stat.Rmd`` for code)
* ``All answers_puzzles all trials.csv`` - same as ``All answers_puzzles.csv`` but only with the 42 participants
who finished all eight trials within the specified amount of time(see ``analysis_stat.Rmd`` for code)
* ``analysis_stat.Rmd`` - R script to conduct the statistical analysis. Using RStudio to open the file is strongly recommended.
* ``analysis_stat.html`` - HTML rendition of the code and results in ``analysis_stat.Rmd``. Opening this file is recommended if the user is not interested in modifying the code.
* ``analysis.py`` - code used to generate the plots in ``plots``
* ``utilities.py`` - useful functions not part of the basic workflow and matplotlib functions for plotting

## The modeling

The code for the modeling and the analysis of the model fit can be found in the ``modeling`` folder.

* ``plots`` - folder containing all plots generated by running the code in fitting.py, if SAVE_BOOL set to True.

* ``epistemic_model.py`` - main logic for the epistemic model and for all variations of the cutting model. Unlike the epistemic model, the cutting models make use of the cut_operators function.
* ``fitting.py`` - implements the RFX-BMS algorithm and computes coherences.
* ``formula.py`` - implements the propositional atoms and logical operators in epistemic logic. Note that only the operators necessary for the experiment have been implemented, but the file can easily be extended to include other operators of (epistemic) logic.
* ``main.py`` - runs one model configuration a specified number of times on specific puzzles. Used mainly for testing.
* ``puzzle_formalism.py`` - implements specification for the "Cheryl's Birthday" puzzles.
* ``solver.py`` - superclass of the epistemic and cutting models. Implemented such that the analysis can be extended to other modeling paradigms, as long as they are defined under the Solver class.
* ``utilities.py`` - useful functions not part of the basic workflow and matplotlib functions for plotting


## Directory tree
```bash
│
├── analysis
│   │
│   ├── all_results\
│   │   │
│   │   ├── results_0103\
│   │   │   ├── All answers_*.csv
│   │   │   └── Puzzle Answers_*.csv
│   │   │
│   │   ├── results_0502\
│   │   │   ├── All answers_*.csv
│   │   │   └── Puzzle Answers_*.csv
│   │   │
│   │   ...
│   │   │
│   │   └── results_2902\
│   │       ├── All answers_*.csv
│   │       └── Puzzle Answers_*.csv
│   │
│   ├── plots\
│   │   ├── acc_per_order.png
│   │   ├── acc_per_scen.png
│   │   ├── distrib_acc_participants.png
│   │   ├── distrib_answers_puzzle.png
│   │   ├── form_data.txt
│   │   ├── p-beauty_distrib.png
│   │   ├── scenario_time_distrib.png
│   │   └── tom_time_distrib.png
│   │
│   ├── All answers_all.csv
│   ├── All answers_puzzles.csv
│   ├── All answers_puzzles all trials.csv
│   ├── analysis.py
│   ├── analysis_stat.Rmd
│   ├── analysis_stat.html
│   └── utilities.py
│   
├── interface
│   │
│   ├── img\
│   │   ├── birthday.png
│   │   ├── drink.png
│   │   ├── hair.png
│   │   ├── sources.txt
│   │   ├── toy.png
│   │   └── warning.png
│   │
│   ├── text\
│   │   ├── background_form_intro.txt
│   │   ├── background_form_outro.txt
│   │   ├── birthday.txt
│   │   ├── drink.txt
│   │   ├── hair.txt
│   │   ├── p-beauty.txt
│   │   ├── practice_intro.txt
│   │   ├── practice_outro.txt
│   │   ├── practice_puzzle.txt
│   │   └── toy.txt
│   │
│   ├── background_form.py
│   ├── Participant puzzles.csv
│   ├── practice_trials.py
│   ├── puzzle.py
│   ├── question_bank.csv
│   ├── question_bank.txt
│   ├── quickstart.py
│   ├── utilities.py
│   └── window.py
│
├── modeling
│   │
│   ├── plots\
│   │   ├── distribcoh_*.png
│   │   ├── distribcoh_*_best.png
│   │   ├── propfit_*.png
│   │   ├── freq_all_answers.png
│   │   └── level_*.png
│   ├── epistemic_model.py
│   ├── fitting.py
│   ├── formula.py
│   ├── main.py
│   ├── puzzle_formalism.py
│   ├── solver.py
│   └── utilities.py
├── README.md
└── requirements.txt 
```

## References

J.D. Top, C. Jonker, R. Verbrugge, and H. de Weerd. Predictive theory of mind models based on public announcement logic. In Nina Gierasimczuk and Fernando R. Vel ́azquez-Quesada, editors, _Dynamic Logic. New Trends and Applications: 5th International Workshop, DaL ́ı 2023_, volume 14401, pages 85–103.
Springer, 2023. 10.1007/978-3-031-51777-8 6.